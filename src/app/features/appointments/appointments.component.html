<div class="lg:p-6 p-3">
  <div class="space-y-2">
    @if (!isFakeLoading()) {
      <div class="flex justify-between items-center flex-col md:flex-row">
        <h1 class="lg:text-3xl text-xl w-full md:w-auto font-bold text-gray-900">
          {{ 'appointments.title' | transloco }}
        </h1>
        <div class="flex items-center gap-2 flex-col md:flex-row w-full md:w-auto">
          <div class="flex bg-gray-100 rounded-lg p-1 w-full md:w-auto">
            <button
              class="w-full md:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm rounded-md transition-colors"
              [ngClass]="{
                'bg-white text-gray-900 shadow-sm': showMode() === 'calendar',
                'text-gray-600 hover:text-gray-900': showMode() !== 'calendar',
              }"
              (click)="showMode.set('calendar')"
            >
              <lucide-icon [img]="CalendarDays" [size]="16"></lucide-icon>
              {{ 'appointments.calendar' | transloco }}
            </button>

            <button
              class="w-full md:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm rounded-md transition-colors"
              [ngClass]="{
                'bg-white text-gray-900 shadow-sm': showMode() === 'list',
                'text-gray-600 hover:text-gray-900': showMode() !== 'list',
              }"
              (click)="showMode.set('list')"
            >
              <lucide-icon [img]="List" [size]="16"></lucide-icon>
              {{ 'appointments.list' | transloco }}
            </button>
          </div>

          <button
            *ngxPermissionsOnly="[userRole.ADMIN, userRole.ACCOUNTANT]"
            class="w-full md:w-auto flex items-center justify-center gap-2 px-4 py-2 text-sm rounded-md bg-sky-500 text-white hover:bg-sky-600 transition ml-2"
            (click)="createAppointment()"
          >
            <lucide-icon [img]="Plus" [size]="16"></lucide-icon>
            {{ 'appointments.create' | transloco }}
          </button>
        </div>
      </div>
    }

    @if (showMode() === 'calendar') {
      @if (isFakeLoading()) {
        <app-calendar-skeleton/>
      } @else {
        <div
          class="bg-white rounded-xl shadow-sm border border-gray-100 h-full flex flex-col"
        >
          <app-calendar-header
            [doctors]="doctorList.value()"
            [isShowClearFilter]="isShowClearFilter()"
            [currentDate]="currentDate()"
            [viewMode]="viewMode()"
            (navigate)="navigateCalendar($event)"
            (setCurrentDate)="setCurrentDate()"
            (setViewMode)="setViewMode($event)"
          />
        </div>
        <div class="flex-1 min-h-0">
          <div
            class="bg-white rounded-xl shadow-sm border border-gray-100 h-full flex flex-col"
          >
            <div class="overflow-x-auto flex-1 min-h-0">
              @if (isWeekMode()) {
                <app-calendar-grid
                  (reload)="appointments.reload()"
                  (clonedAppointment)="clonedAppointment($event)"
                  [appointments]="sortedAppointments()"
                  [doctors]="doctorList.value()"
                  [displayDays]="displayDays()"
                  [timeSlots]="timeSlots()"
                  [isWeekMode]="isWeekMode()"
                  (appointmentClick)="onAppointmentClick($event)"
                  (timeSlotClick)="timeSlotClick($event)"
                />
              } @else {
                <app-calendar-day
                  (reload)="appointments.reload()"
                  (timeSlotClick)="timeSlotClick($event)"
                  [appointments]="sortedAppointments()"
                  [doctors]="doctorList.value()"
                  [displayDays]="displayDays()"
                  [timeSlots]="timeSlots()"
                />
              }
            </div>
            <app-calendar-legend/>
          </div>
        </div>
      }
    } @else {
      <form [formGroup]="filterForm" class="flex-col md:flex-row flex items-center md:gap-4 gap-2 md:mb-6 mb-3">
          <div class="relative w-full">
            <input
              formControlName="search"
              class="w-full pl-10 pr-20 py-3 border border-gray-200 rounded-lg focus:outline-none"
              type="text"
              placeholder="{{ 'appointment-list.search_placeholder' | transloco }}"
            />
            <button
              class="absolute right-1 top-1 text-white rounded-lg px-4 py-2 hover:bg-blue-600 focus:outline-none"
              style="background-color: #0ea5e9"
              type="button"
            >
              <img
                src="assets/icons/search.svg"
                alt="{{ 'appointment-list.search' | transloco }}"
                class="w-5 h-5"
              />
            </button>
          </div>

          <select
            class="w-52 text-sm px-3 py-2 rounded-lg border border-gray-200 bg-white focus:ring-2 focus:ring-sky-500"
            formControlName="status"
          >
            <option value="ALL">
              {{ 'appointment-list.status_all' | transloco }}
            </option>
            <option [value]="AppointmentStatus.SCHEDULED">
              {{ 'appointment-list.status_scheduled' | transloco }}
            </option>
            <option [value]="AppointmentStatus.COMPLETED">
              {{ 'appointment-list.status_completed' | transloco }}
            </option>
            <option [value]="AppointmentStatus.CANCELLED">
              {{ 'appointment-list.status_cancelled' | transloco }}
            </option>
            <option [value]="AppointmentStatus.TEMPORARY">
              {{ 'appointment-list.status_temporary' | transloco }}
            </option>
            <option [value]="AppointmentStatus.CANCELLED_FOREVER">
              {{ 'appointment-list.status_cancelled_forever' | transloco }}
            </option>
          </select>
        </form>

      @if (isMobile()) {
        <div class="flex flex-col gap-4">
          @for (appointment of sortedAppointments(); track appointment.id) {
            <app-mobile-appointment-card
              [appointment]="appointment"
              (edit)="editAppointment($event)"
              (reload)="appointments.reload()"
            />
          } @empty {
            <div class="text-center text-gray-500 py-8">
              {{ 'appointment-list.no_records' | transloco }}
            </div>
          }
        </div>
      } @else {
        <app-appointment-list
          [appointments]="sortedAppointments()"
          (edit)="editAppointment($event)"
          (reload)="appointments.reload()"
        />
      }
    }
  </div>
</div>
